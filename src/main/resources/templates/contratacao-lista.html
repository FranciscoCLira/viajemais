<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Histórico de Contratações</title>
  <link rel="stylesheet" th:href="@{/css/estilo.css}">
</head>
<body>
  <div class="container">
    <!-- Cabeçalho -->
	<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
	  <h1 style="margin:0;">Histórico de Contratações</h1>
        <!-- Mesma classe do rodapé, garante cor azul idêntica -->
        <button type="button"
                class="botao-voltar"
                onclick="window.location.href='/'">
            Voltar à página inicial
        </button>
	</div>

	<div th:if="${erroExclusao}" class="alert alert-danger" th:text="${erroExclusao}"></div>
	<div th:if="${sucesso}"    class="alert alert-success" th:text="${sucesso}"></div>
	
	
    <table>
      <thead>
        <tr>
          <th>Nr. Ident.</th>
          <th>Cliente</th>
          <th>Data Confirmação</th>
          <th>Período</th>
          <th>Qtde. Pessoas</th>
          <th>Qtde. Diárias</th>
          <th>Detalhes Destinos</th>
          <th>Total R$</th>
          <th>Ações</th> <!-- cabeçalho de ações -->
        </tr>
      </thead>
      <tbody>
        <tr th:each="c : ${contratacoes}">
          <td th:text="${c.id}">1</td>
          <td th:text="${c.nomeCliente}">Fulano</td>
          <td th:text="${#temporals.format(c.data,'dd/MM/yyyy')}">08/06/2025</td>
          <td th:text="|${#temporals.format(c.periodoInicio,'dd/MM/yyyy')} a 
                        ${#temporals.format(c.periodoFim,'dd/MM/yyyy')}|">
            01/06/2025 a 05/06/2025
          </td>
          <td th:text="${c.quantidadePessoas}">2</td>
          <td th:text="${c.quantidadeDiarias}">4</td>
          <td>
            <ul>
              <li th:each="item : ${c.itens}">
                <span th:text="${item.destino.local}">Praia</span> Diária: 
                  <strong class="ptbr" th:attr="data-value=${item.precoUnitario}"></strong>
                 Tot: 
                  <strong class="ptbr" th:attr="data-value=${item.valorDestino}"></strong>
              </li>
            </ul>
          </td>
          <td>
            <strong class="ptbr" th:attr="data-value=${c.totalViagem}"></strong>
          </td>
	          <td class="acoes-cell">
	          <a th:href="@{/contratacao/editar/{id}(id=${c.id})}"
	             class="confirmar">Editar</a>
	
	          <a th:if="${podeExcluirMap[c.id]}"
	             th:href="@{/contratacao/excluir/{id}(id=${c.id})}"
	             class="cancelar"
	             onclick="return confirm('Confirma exclusão?');">
	            Excluir
	          </a>
	        </td>
	        </tr>
      </tbody>
    </table>


		<!-- Botões no rodapé, centralizados e lado a lado -->
	    <div style="text-align: center; margin-top: 20px;">
	        <button type="button"
	                class="botao-voltar"
	                style="margin-right: 0.5rem;"
	                onclick="window.scrollTo(0,0);">
	            Voltar ao início desta página
	        </button>
	        
	        <button type="button"
	                class="botao-voltar"
	                onclick="window.location.href='/'">
	            Voltar à página inicial
	        </button>
	    </div>
  </div>

  <script>
    // Formata elementos .ptbr em pt-BR (milhar '.', decimal ',')
    document.querySelectorAll('.ptbr').forEach(el => {
      const raw = el.getAttribute('data-value');
      const num = parseFloat(raw);
      if (!isNaN(num)) {
        el.textContent = num.toLocaleString('pt-BR', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
      }
    });
  </script>
</body>
</html>
